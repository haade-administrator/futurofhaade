---
guid: 68
title: "Domotise n'importe quel compteur edf pour 20‚Ç¨ en 5 minutes"
description: "Rel√®ve en 5 minutes la t√©l√©info dans home assistant sur n'importe quel compteur edf (ancien et linky) avec une cl√© micro t√©l√©info v3.0 par charles Hallard √† 20‚Ç¨, par l'interm√©diaire des modules mqtt et t√©l√©info2mqtt"
layout: post
author: Nico
date: 2023-06-04 21:01
last_modified_at: 2023-06-07 11:17
categories: [Haade-lab, Tests]
tags: []
image: 'micro-teleinfo-v3-homeassistant-teleinfo2mqtt-20‚Ç¨-5minutes.png'
toc: true
beforetoc: ''
published: true
noindex: false
sitemap:
  changefreq: 'monthly'
  exclude: 'no'
  priority: 0.5 #between 0.0 to 1.0, 1.0 high priority
  lastmod:  # date to end modification
locale: fr_FR
addViews: 1111
comments: true
rating: 5.0
sourcelink:
  - https://www.tindie.com/stores/hallard/
  - https://github.com/hallard/uTeleinfo/tree/main
  - https://community.ch2i.eu/category/9/microt%C3%A9l%C3%A9info
redirect_from: 
  - /fr/blog/domotise-linky-¬µteleinfo-homeassistant-20-5minutes
---

Il y a de **nombreuses fa√ßons** de r√©cup√©rer la t√©l√©info du compteur Edf, l'un des derniers modules en date **est le Lixee** mais il a le d√©savantage de **n'√™tre compatible** qu'avec certains compteurs. Je vais te montrer comment faire remonter la t√©l√©info dans home assistant pour 20‚Ç¨ sans modules wifi esp32/8266, avec un **micro module usb** fabriqu√© par Charles Hallard le dernier en date est le **micro t√©l√©info v3.0, nomm√© aussi ¬µt√©l√©info**.

## Pr√©requis
- homeassistant OS
- un [micro Teleinfo v3.0 par Charles Hallard](https://www.tindie.com/products/hallard/micro-teleinfo-v30/){: target="_blank"} usb
- du fil communication
- un compteur EDF

J'ai pu r√©aliser cette installation facilement pour un amis qui va domotiser son domicile en montant un raspberry pi 4 dans un boitier rail din directement dans le tableau √©l√©ctrique √† proximit√© du compteur EDF.

> cette installation est compatible avec tous les compteurs EDF du march√©.

### Liens connexes

[int√©grer un compteur √©l√©ctrique t√©l√©info dans home assistant]({% post_url /fr/2021-08-03-integrer-son-compteur-electrique-teleinfo-dans-home-assistant %})

[int√©grer la t√©l√©info au dashboard energie de home assistant]({% post_url /fr/2022-01-03-integrer-la-teleinfo-au-dashboard-energie-dans-home-assistant %})


### Avantage de cette installation:
{: .blue}
- facile √† mettre en place
- le tarif

### Inconv√©nient:
{: .red}
- proximit√© entre le module home assistant et le compteur
- monopolise un port usb
- absorbe un peu de puissance de la box domotique environ 3w

**Parlons un peu de l'installation:** ce tuto permet de faire remonter les infos par l'interm√©diaire du *service mqtt*. Il te faudra installer le module compl√©mentaire **officiel mosquitto**, ensuite je vais te montrer comment installer le **module compl√©mentaire t√©l√©info2mqtt** d√©velopp√© par *fmartinou* celui-ci est fonctionnel avec tous les TIC usb du march√© donc avec le micro t√©l√©info V3 de Charles Hallard.

## Top Chrono installation en (5 minutes)

> Pour r√©aliser cette installation n'h√©site pas √† utiliser les liens **my.homeassistant.io** ci-dessous.

### Module MQTT mosquitto

**1** Installe le module compl√©mentaire MQTT, Mosquitto

[param√®tres > Modules compl√©mentaires > Boutiques des modules compl√©mentaires] ou clic sur le lien ci-dessous

{% include homeassistantlink.html supervisor_addon="core_mosquitto" %}

**2** Ensuite cr√©e un **compte utilisateur** dans home assistant pour mosquitto, en g√©n√©ral je met en nom d'utilisateurs **mqtt** plus facile √† reconnaitre üòè

{% include homeassistantlink.html users="" %}

**3** Retourne dans la configuration mosquitto

{% include homeassistantlink.html supervisor_addon="core_mosquitto/config" %}

et rajoute ces lignes dans l'onglet logins comme sur la capture d'image ci-dessous.

{% picture posts/{{page.guid}}/parametrage-user-core-mosquitto-home-assistant.png --alt param√©trage users dans core mosquitto mqtt home assistant pour micro t√©l√©info v3.0 --img width="940" height="279" %}

{% highlight shell %}
- username: "le login utilisateur"
  password: "mot de passe utilisateur"
{% endhighlight %}

**4 D√©marre Mosquitto**

jette un coup d'oeil au journal des infos afin de voir le bon fonctionnement du module.

{% include homeassistantlink.html supervisor_addon="core_mosquitto/logs" %}

### Module t√©l√©info2mqtt

[lien github du module t√©l√©info2mqtt](https://github.com/fmartinou/teleinfo2mqtt){: target="_blank"}

L'avantage de ce module et sa simplicit√©, [accompagn√©e d'une documentation soign√©e](https://fmartinou.github.io/teleinfo2mqtt/#/introduction/){: target="_blank"}. Il a aussi l'avantage d'√™tre **stable**.

**1** Installe le module compl√©mentaire t√©l√©info2mqtt

commence par ajouter le d√©p√¥t externe de fmartinou **https://github.com/fmartinou/hassio-addons**, ou clic directement sur le lien ci-dessous:

{% include homeassistantlink.html supervisor_addon_repository="https://github.com/fmartinou/hassio-addons" %}

{% picture posts/{{page.guid}}/fmartinou-repository-addons-haos.png --alt fmartinou r√©pertoire modules compl√©mentaires home assistant --img width="851" height="140" %}


**2** Une fois l'installation faite le module aura cr√©√© un **appareil nomm√© teleinfo2mqtt** qui permet en autre de controler les mises √† jours.

{% picture posts/{{page.guid}}/fmartinou-teleinfo-appareil-teleinfo2mqtt.png --alt fmartinou t√©l√©info2mqtt appareil dans home assistant --img width="940" height="721" %}

**3** Branche la cl√© **micro t√©l√©info v3.0** de Charles Hallard sur le raspberry et red√©marre homeassistant en haut √† droite

{% include homeassistantlink.html settings="" %}

**4** Param√®tre **t√©l√©info2mqtt**

{% include homeassistantlink.html supervisor_addon="9afc8f77_teleinfo2mqtt/config" %}

Branche le module t√©l√©info sur ta box domotique
**red√©marre homeassistant**
- [va dans param√®tres > syst√®me > mat√©riel] et clic sur **tout le mat√©riel**
- r√©cup√®re le lien exacte de la cl√© ( voir la capture ci-dessous)

{% picture posts/{{page.guid}}/lien-serie-usb-micro-teleinfo-v3-charles-hallard.png --alt r√©cup√©ration du lien serie de la cl√© micro t√©l√©info v3 de charles Hallard dans home assistant --img width="511" height="945" %}

Ensuite retourne sur t√©l√©info2mqtt et param√®tre t√©l√©info2mqtt, **pour terminer d√©marre le module**.

{% picture posts/{{page.guid}}/parametrage-teleinfo2mqtt.png --alt param√©trage du module t√©l√©info2mqtt dans home assistant --img width="940" height="832" %}

Une fois d√©marr√© et l'installation compl√®te, par l√† je veux dire branch√© sur le compteur EDF les trames tic vont remonter dans mosquitto. Tu pourras aussi **voir les infos du journal** dans l'onglet info du module et te rendre compte du bon fonctionnement de l'ensemble.

{% include homeassistantlink.html supervisor_addon="9afc8f77_teleinfo2mqtt/logs" %}

{% picture posts/{{page.guid}}/remonte-teleinfo2mqtt-dans-mosquitto.png --alt remont√©e des infos tic dans home assistant par le biais mqtt et t√©l√©info2mqtt --img width="940" height="698" %}

## Remont√©e Puissance dans le Dashboard Home assistant

Il est facile de faire remonter la pussance totale dans le dashboard Lovelace sous forme de jauges. Ajoute une carte jauge ou gauge en anglais et ajoute **l'entit√© t√©l√©info PAPP**. J'ai un abonnement 12Kv donc j'ai fait en fonction de mon abonnement pour calibrer la puissance de la jauge.

{% picture posts/{{page.guid}}/home-assistant-lovelace-gauge-teleinfo-kwh.png --alt param√©trage puissance totale PAPP dans le dashboard Lovelace de Home assistant --img width="940" height="674" %}

N'h√©site pas √† modifier les pallier suivant ton abonnement √©l√©ctrique.

{% highlight yaml %}
type: gauge
name: Volt
min: 0
max: 12000
severity:
  green: 0
  yellow: 6000
  red: 9000
entity: sensor.teleinfo_XXXXXXXXXXXX_papp
needle: true
{% endhighlight %}

> Voil√† le r√©sultat final, je trouve le visuel net et clair.

{% picture posts/{{page.guid}}/lovelace-teleinfo-papp.png --alt remont√©e puissance totale PAPP dans le dashboard Lovelace de Home assistant --img width="482" height="195" %}

## Param√©trage onglet √©nergie

Continue et **clic sur le lien ci-dessous** ensuite sur [Consommation du r√©seau > ajouter la consommation du r√©seau]

{% include homeassistantlink.html energy="" %}

Tu devrais voir appara√Ætre deux lignes, l'une pour l'heure creuse HCHC et une pour l'heure pleine HCHP, ajoute les deux.

{% picture posts/{{page.guid}}/parametrage-energie-teleinfo2mqtt-micro-teleinfo-v3-charles-hallard-home-assistant.png --alt parametrage energie teleinfo2mqtt micro teleinfo v3 charles hallard home assistant --img width="797" height="756" %}

Si tu utilises d√©j√† l'onglet √©nergie **clic plut√¥t** sur ce lien pour param√©trer l'√©nergie dans HA.

{% include homeassistantlink.html config_energy="" %}

> Enfin apr√®s environ 1 √† 2h admire les bargraphs et contr√¥le la consommation

{% picture posts/{{page.guid}}/capture-energie-micro-teleinfo-v3-charles-hallard.png --alt capture consommation onglet √©nergie dans home assistant avec le ¬µt√©l√©info v3.0 par charles Hallard --img width="940" height="621" %}


## Parlons du module Micro T√©l√©info v3.0 (uteleinfo)

Je l'ai [command√© sur la plateforme tindie](https://www.tindie.com/products/hallard/micro-teleinfo-v30/){: target="_blank"} et r√©ceptionn√© 3 jours apr√®s par lettre verte la poste, merci pour cette rapidit√©, j'ai command√© la version 3 finale enti√®rement assembl√©, et livr√© **j'en ai eu pour 21‚Ç¨**.

{% picture posts/{{page.guid}}/presentation-¬µteleinfo-v3-charles-hallard-integration-home-assistant.png --alt taille et pr√©sentation du module micro, ¬µt√©l√©info v3.0 par charles Hallard --img width="940" height="529" %}

**Dimensions:**

L 55mm x l 14mm x P 1mm 

**Quels sont les changements de la v3**

- R3 remplac√© par un pot trim√®re pour permettre d'ajuster la sensibilit√© TIC dans de rares cas
- Leds s√©par√©es pour RX / TX
- PCB plaqu√© or
- Taille r√©duite du circuit imprim√©
- LED ajout√©e donc voir signal TIC Teleinfo
- Ajout de LED rouges/vertes TX/RX
- Entr√©e r√©sistance TIC r√©gl√©e sur 220 Ohms
- R√©sistance MOSFET 3,3 KOhms
- En raison d'une p√©nurie, changement de la puce FT230XS par CH9106

Faut dire que la v3.0 du ¬µt√©l√©info illumine, tu ne pourras pas r√¢ter le transfert de donn√©es.
> peut-√™tre un peu trop lumineux √† mon go√ªt.

![Transmission informations led micro Teleinfo v3.0 sur compteur dans home assistant]({{ site.baseurl }}/assets/images/posts/{{ page.guid }}/Micro-Teleinfo-v3-charles-hallard-blink.webp{{ cachebuster }}){: width="420" height="282"}{: target="_blank"}

## Conclusion

Voil√† un exemple d'installation facile √† mettre en place pour **relever la t√©l√©info sur le linky** ou tout autre compteur edf du march√©. **Charles Hallard** a su cr√©er un *module peu cher, de petite taille et efficace*. En ce qui concerne l'int√©gration on a tendance √† utiliser le transfert d'info par mqtt fr√©quemment, surtout si tu utilises Zigbee2mqtt alors je trouve l'alternative **t√©l√©info2mqtt** pratique √† mettre en place et relativement bien fa√Æte. Il existe toutes sortes d'int√©grations de la t√©l√©info voici en une, **reli√©e au port usb**. 
> Alors √©clate toi.
